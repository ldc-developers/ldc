name: Build bootstrap LDC
inputs:
  cmake_flags:
    required: false
    default: ''
  extra_d_flags: # applying to the D executables, not the runtime
    required: false
    default: ''
  arch:
    required: false # Windows only
runs:
  using: composite
  steps:

    - name: Check CMake and ninja versions
      shell: bash
      run: |
        set -eux
        cmake --version
        ninja --version

    - name: Build bootstrap LDC
      uses: ./.github/actions/helper-build-ldc
      with:
        build_dir: bootstrap-ldc
        host_dc: ldmd2
        cmake_flags: >-
          -DBUILD_SHARED_LIBS=OFF
          ${{ inputs.cmake_flags }}
          "-DCMAKE_C_COMPILER=${{ runner.os != 'Windows' && '$PWD/../clang/bin/clang' || 'clang-cl' }}"
          "-DCMAKE_CXX_COMPILER=${{ runner.os != 'Windows' && '$PWD/../clang/bin/clang++' || 'clang-cl' }}"
        extra_d_flags: ${{ inputs.extra_d_flags }}
        arch: ${{ inputs.arch }}

    - run: ../bootstrap-ldc/bin/ldc2 --version
      shell: bash

language: cpp
compiler:
  - gcc
install:
  - sudo sudo sh -c "echo 'deb http://archive.ubuntu.com/ubuntu/ precise-proposed restricted main multiverse universe' >> /etc/apt/sources.list"
  - sudo sudo sh -c "echo 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise main' >> /etc/apt/sources.list"
  - wget -O - http://llvm.org/apt/llvm-snapshot.gpg.key | sudo apt-key add -
  - sudo apt-get update -qq
  - sudo apt-get install -qq $LLVM_PACKAGE libconfig++8-dev
  - [[ "${OPTS}" == *MULTILIB*ON* ]] && sudo apt-get install -qq gcc-multilib libcurl3:i386
  - [[ "${OPTS}" == *MULTILIB*ON* ]] && sudo ln -s /usr/lib/i386-linux-gnu/libcurl.so.4.2.0 /usr/lib/i386-linux-gnu/libcurl.so
env:
  - LLVM_PACKAGE="llvm-3.1 llvm-3.1-dev" TESTSUITE_FILTER=debug OPTS="-DMULTILIB=ON" THECC=gcc THECXX=g++
  - LLVM_PACKAGE="llvm-3.2 llvm-3.2-dev" TESTSUITE_FILTER=debug THECC=gcc THECXX=g++
  - LLVM_PACKAGE="llvm-3.3 llvm-3.3-dev" TESTSUITE_FILTER=debug OPTS="-DMULTILIB=ON" THECC=clang THECXX=clang++
script:
  - CC=$THECC CXX=$THECXX cmake $OPTS .
  - make
  - bin/ldmd2 -unittest -m32 runtime/phobos/std/net/curl.d runtime/emptymain.d
  - bin/ldc2 -version # For environment info.
  - ctest --output-on-failure -R $TESTSUITE_FILTER

notifications:
  # Temporarily disabled due to time limit problems.
  # email:
  #   recipients:
  #     - "ldc-dev@googlegroups.com"
  #   on_success: never
  #   on_failure: change
  irc:
    channels:
      - "irc.freenode.org#ldc"
    on_success: always
    on_failure: always
    use_notice: false
    skip_join: true
